<!-- views/history.ejs -->
<!DOCTYPE html>
<html lang="en" class="h-full" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modified Documents - Paperless-AI</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>

<body class="h-full">
    <button id="themeToggle" class="theme-toggle">
        <i class="fas fa-moon dark:fas fa-sun"></i>
    </button>

    <div class="layout-container">
        <button id="mobileMenuButton" class="mobile-menu-button">
            <i class="fas fa-bars"></i>
        </button>
        <!-- Sidebar -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h1 class="brand-title">Paperless-AI<small style="display: block;"><%= version %></small></h1>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/dashboard" class="sidebar-link"><i class="fas fa-home"></i><span>Dashboard</span></a>
                    </li>
                    <li><a href="/manual" class="sidebar-link"><i class="fas fa-file-alt"></i><span>Manual</span></a>
                    </li>
                    <li><a href="/chat" class="sidebar-link"><i class="fa-solid fa-comment"></i><span>Chat</span></a>
                    </li>
                    <li><a href="/playground" class="sidebar-link"><i
                                class="fa-solid fa-flask-vial"></i><span>Playground</span></a></li>
                    <li><a href="/history" class="sidebar-link active"><i
                                class="fa-solid fa-clock-rotate-left"></i><span>History</span></a></li>
                    <li><a href="/settings" class="sidebar-link"><i class="fas fa-cog"></i><span>Settings</span></a>
                    </li>
                    <li><a href="/logout" class="sidebar-link"><i
                                class="fa-solid fa-right-from-bracket"></i><span>Logout</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="content-wrapper">
                <div class="content-header flex justify-between items-center mb-6">
                    <h1 class="content-title">Modified Documents</h1>
                    <div class="flex gap-4">
                        <button id="resetSelectedBtn"
                            class="material-button">
                            Reset Selected
                        </button>
                        <button id="resetAllBtn" class="material-button">
                            Reset All
                        </button>
                    </div>
                </div>

                <!-- Custom Filters -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <div class="min-w-[200px]">
                        <select id="tagFilter" class="modern-input">
                            <option value="">All Tags</option>
                            <% filters.allTags.forEach(function(tag) { %>
                            <option value="<%= tag.id %>"><%= tag.name %></option>
                            <% }); %>
                        </select>
                    </div>

                    <div class="min-w-[200px]">
                        <select id="correspondentFilter" class="modern-input">
                            <option value="">All Correspondents</option>
                            <% filters.allCorrespondents.forEach(function(corr) { %>
                            <option value="<%= corr %>"><%= corr %></option>
                            <% }); %>
                        </select>
                    </div>
                </div>

                <!-- DataTable -->
                <div class="material-card">
                    <div class="overflow-x-auto">
                        <table id="historyTable" class="w-full">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAll" class="rounded"></th>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Tags</th>
                                    <th>Correspondent</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal for Selected Documents -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Reset</h3>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content">
                <p class="mb-4">Are you sure you want to reset the selected documents to their original values?
                    This action cannot be undone.</p>
                <div class="flex justify-end gap-4">
                    <button id="cancelReset"
                        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100">Cancel</button>
                    <button id="confirmReset" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Confirm
                        Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal for All Documents -->
    <div id="confirmModalAll" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Reset All</h3>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content">
                <p class="mb-4">Are you sure you want to reset <b>all</b> documents to their original values? This
                    action cannot be undone.</p>
                <div class="flex justify-end gap-4">
                    <button id="cancelResetAll"
                        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100">Cancel</button>
                    <button id="confirmResetAll"
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Confirm Reset</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const sidebar = document.querySelector('.sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function toggleSidebar(event) {
                event.stopPropagation(); // Prevent event bubbling
                sidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');

                // Toggle menu icon
                const icon = mobileMenuButton.querySelector('i');
                if (sidebar.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }

            // Toggle sidebar when clicking the menu button
            mobileMenuButton.addEventListener('click', toggleSidebar);

            // Close sidebar when clicking the overlay
            sidebarOverlay.addEventListener('click', function (event) {
                event.stopPropagation(); // Prevent event bubbling
                if (sidebar.classList.contains('active')) {
                    toggleSidebar(event);
                }
            });

            // Prevent sidebar from closing when clicking inside it
            sidebar.addEventListener('click', function (event) {
                event.stopPropagation();
            });

            // Handle links in sidebar
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    // Don't prevent default here to allow navigation
                    event.stopPropagation();
                });
            });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="js/history.js"></script>
</body>

</html>
